/*
 * Comunicacao.cpp
 *
 *  Created on: 24/10/2015
 *      Author: Igo Romero
 */

#include "../include/Comunicao.h"

#ifdef __linux__
#include <stdio.h>
#include <fcntl.h>
#endif

Comunicacao::Comunicacao(char* porta) {
	hPorta = 0;
	this->hPorta = porta;
}

int Comunicacao::iniciar() {
	int resultado = EXIT_SUCCESS;

	//Windows
#ifdef _WIN32 || _WIN64

	hPorta = CreateFile(porta, GENERIC_READ | GENERIC_WRITE, // cria um arquivo para acessar
				0, NULL, OPEN_EXISTING, 0, NULL);
		//caso nao der certo pega o erro do SO
		if (hPorta == INVALID_HANDLE_VALUE){ //verifica se conseguiu pegar o identificador
			//pega o erro se der problema
			resultado = GetLastError();
		} else {
			//configuracao da porta
			DCB dcb; //estrutura de dados do Windows p/ acesso a porta serial
			memset(&dcb, 0, sizeof(dcb)); //zerar a dcb
			dcb.DCBlength = sizeof(dcb);
			dcb.BaudRate = CBR_9600; //definindo a velocidade de leitura da serial
			dcb.Parity = NOPARITY; // vao verifica o bit de paridade
			dcb.StopBits = ONESTOPBIT;
			dcb.BySize = 8;
			// se eu nao conseguir configurar a porta
			if (!SetCommState(hPorta, &dcb)){
				resultado  = GetLastErro();
			}
		}

#endif
}

